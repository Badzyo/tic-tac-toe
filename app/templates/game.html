{% extends "base.html" %}
{% from "macros/macros.html" import render_grid %}
{% from "macros/macros.html" import render_button %}
{% block content %}
    <div class="main-block row col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-xs-12">
        <h3>
        {% set relations = game.users | sort(attribute='user_role') %}
        {% for relation in relations %}
            {{ relation.user.username }}
            {% if loop.first %} vs {% endif %}
        {% endfor %}
        {% if relations | length == 1 %}
            ___
        {% endif %}
        </h3>
        <div id="buttons">
            {% if current_user.id in game.users | map(attribute='user_id') %}
                {% if game.state != 3 %}
                    {% with flee_url = url_for('flee_game') %}
                    {{ render_button(action_url=flee_url, action_text='Flee', id_='flee-btn', btn_class='btn btn-info') }}
                    {% endwith %}
                {% endif %}
            {% else %}
                {% if game.state == 0 %}
                    {% with join_url = url_for('join_game', game_id=game.id) %}
                    {{ render_button(action_url=join_url, action_text='Join this game', id_='join-btn', btn_class='btn btn-primary') }}
                    {% endwith %}
                {% endif %}
            {% endif %}
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                {{ render_grid(game) }}
                <p>Game state: {{ game.state }}</p>
                <p>Game win length: {{ game.win_length }}</p
            </div>
        </div>
        <p>
            <a href="{{ url_for('index') }}" >Go to homepage</a>
        </p>
    </div>
{% endblock %}